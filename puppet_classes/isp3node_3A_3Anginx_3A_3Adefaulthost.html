<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: isp3node::nginx::defaulthost
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "puppet_classes::isp3node::nginx::defaulthost";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (i)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">isp3node::nginx::defaulthost</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: isp3node::nginx::defaulthost</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/nginx/defaulthost.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  Set up a default page on hosts FQDN

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Places a default startpage on the hosts FQDN containing links to tools for
the customers like mailman, webmail, phpmyadmin or ispconfig. RSpamd is not
listed as link, because usually not ment for public access.</p>

  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_isp3node'>isp3node</span><span class='op'>::</span><span class='id identifier rubyid_nginx'>nginx</span><span class='op'>::</span><span class='id identifier rubyid_defaulthost'>defaulthost</span></code></pre>
    
  </div>



</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/nginx/defaulthost.pp', line 9</span>

class isp3node::nginx::defaulthost {
  file{&#39;/var/www&#39;:
    ensure  =&gt; directory,
  }
  -&gt; file{&#39;/var/www/default&#39;:
    ensure  =&gt; directory,
  }
  -&gt; concat{&#39;/var/www/default/index.html&#39;:
    ensure  =&gt; present,
  }

  concat::fragment{&#39;startpage_header&#39;:
    target  =&gt; &#39;/var/www/default/index.html&#39;,
    content =&gt; epp(&#39;isp3node/web/startpage.head.html&#39;),
    order   =&gt; &#39;00&#39;
  }
  concat::fragment{&#39;startpage_begin&#39;:
    target  =&gt; &#39;/var/www/default/index.html&#39;,
    content =&gt; epp(&#39;isp3node/web/startpage.body1.html&#39;),
    order   =&gt; &#39;01&#39;
  }
  concat::fragment{&#39;startpage_end&#39;:
    target  =&gt; &#39;/var/www/default/index.html&#39;,
    content =&gt; epp(&#39;isp3node/web/startpage.body2.html&#39;),
    order   =&gt; &#39;98&#39;
  }

  nginx::resource::server { &quot;${facts[&#39;fqdn&#39;]}-http&quot;:
    ensure              =&gt; present,
    server_name         =&gt; [$facts[&#39;fqdn&#39;]],
    listen_ip           =&gt; $facts[&#39;networking&#39;][&#39;ip&#39;],
    ipv6_listen_ip      =&gt; $facts[&#39;networking&#39;][&#39;ip6&#39;],
    www_root            =&gt; &#39;/var/www/default&#39;,
    location_cfg_append =&gt; {
      &#39;rewrite&#39; =&gt; &#39;^ https://$server_name$request_uri? permanent&#39;
    },
  }

  nginx::resource::server { $facts[&#39;fqdn&#39;]:
    ensure         =&gt; present,
    listen_port    =&gt; 443,
    listen_ip      =&gt; $facts[&#39;networking&#39;][&#39;ip&#39;],
    ipv6_listen_ip =&gt; $facts[&#39;networking&#39;][&#39;ip6&#39;],
    www_root       =&gt; &#39;/var/www/default&#39;,
    ssl            =&gt; true,
    ssl_cert       =&gt; &quot;/etc/ssl/local/${facts[&#39;fqdn&#39;]}.bundle.crt&quot;,
    ssl_key        =&gt; &quot;/etc/ssl/local/${facts[&#39;fqdn&#39;]}.key&quot;,
  }

  unless (lookup(&#39;isp3node::base::ssl::letsencrypt&#39;, undef, undef, false)){
    File[&quot;/etc/ssl/local/${facts[&#39;fqdn&#39;]}.bundle.crt&quot;] ~&gt; Service[&#39;nginx&#39;]
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>